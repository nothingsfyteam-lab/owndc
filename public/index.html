<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OwnDc - Voice & Chat Platform</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="alternate icon" href="/favicon.ico">
</head>
<body>
  <!-- Auth Screens -->
  <div id="auth-container" class="auth-container">
    <div class="auth-box">
      <div class="auth-logo">
        <i class="fas fa-comments"></i>
        <h1>OwnDc</h1>
      </div>
      
      <!-- Login Form -->
      <div id="login-form" class="auth-form">
        <h2>Welcome back!</h2>
        <p class="auth-subtitle">We're so excited to see you again!</p>
        
        <div class="form-group">
          <label for="login-email">EMAIL</label>
          <input type="email" id="login-email" placeholder="Enter your email" onkeypress="handleEnterKey(event, 'login')">
        </div>
        
        <div class="form-group">
          <label for="login-password">PASSWORD</label>
          <input type="password" id="login-password" placeholder="Enter your password" onkeypress="handleEnterKey(event, 'login')">
        </div>
        
        <button class="auth-btn" onclick="handleLogin()">Log In</button>
        
        <p class="auth-switch">
          Need an account? <a href="#" onclick="showRegister()">Register</a>
        </p>
        
        <div id="login-error" class="auth-error"></div>
      </div>
      
      <!-- Register Form -->
      <div id="register-form" class="auth-form hidden">
        <h2>Create an account</h2>
        
        <div class="form-group">
          <label for="register-username">USERNAME</label>
          <input type="text" id="register-username" placeholder="Choose a username" onkeypress="handleEnterKey(event, 'register')">
        </div>
        
        <div class="form-group">
          <label for="register-email">EMAIL</label>
          <input type="email" id="register-email" placeholder="Enter your email" onkeypress="handleEnterKey(event, 'register')">
        </div>
        
        <div class="form-group">
          <label for="register-password">PASSWORD</label>
          <input type="password" id="register-password" placeholder="Create a password" onkeypress="handleEnterKey(event, 'register')">
        </div>
        
        <button class="auth-btn" onclick="handleRegister()">Continue</button>
        
        <p class="auth-switch">
          Already have an account? <a href="#" onclick="showLogin()">Log In</a>
        </p>
        
        <div id="register-error" class="auth-error"></div>
      </div>
    </div>
  </div>

  <!-- Main App -->
  <div id="app-container" class="app-container hidden">
    <!-- Server Sidebar -->
    <div class="server-sidebar">
      <div class="server-icon home active" onclick="showHome()">
        <i class="fas fa-home"></i>
        <div class="server-tooltip">Home</div>
      </div>
      <div class="server-divider"></div>
      <div id="server-list"></div>
      <div class="server-icon add" onclick="showCreateChannel()">
        <i class="fas fa-plus"></i>
        <div class="server-tooltip">Add Channel</div>
      </div>
    </div>

    <!-- Channel Sidebar -->
    <div class="channel-sidebar">
      <div class="channel-header">
        <h3>OwnDc</h3>
      </div>
      
      <div class="channel-section">
        <div class="section-header">
          <i class="fas fa-chevron-down"></i>
          <span>TEXT CHANNELS</span>
        </div>
        <div id="text-channels" class="channel-list"></div>
      </div>
      
      <div class="channel-section">
        <div class="section-header">
          <i class="fas fa-chevron-down"></i>
          <span>VOICE CHANNELS</span>
        </div>
        <div id="voice-channels" class="channel-list"></div>
      </div>

      <div class="channel-section">
        <div class="section-header" onclick="toggleSection('friends-list')">
          <i class="fas fa-chevron-down" id="friends-chevron"></i>
          <span>FRIENDS</span>
        </div>
        <div id="friends-list" class="friends-list"></div>
      </div>

      <div class="channel-section">
        <div class="section-header" onclick="toggleSection('groups-list')">
          <i class="fas fa-chevron-down" id="groups-chevron"></i>
          <span>GROUPS</span>
        </div>
        <div id="groups-list" class="groups-list"></div>
      </div>
      
      <div class="user-panel">
        <div class="user-info">
          <div class="user-avatar" id="user-avatar"></div>
          <div class="user-details">
            <span class="user-name" id="user-name"></span>
            <span class="user-status" id="user-status">Online</span>
          </div>
        </div>
        <div class="user-actions">
          <button onclick="showAddFriend()" title="Add Friend" style="position: relative;">
            <i class="fas fa-user-plus"></i>
            <span id="friend-request-badge" class="notification-badge" style="display: none;"></span>
          </button>
          <button onclick="showCreateGroup()" title="Create Group"><i class="fas fa-users"></i></button>
          <button onclick="showEditProfile()" title="Edit Profile"><i class="fas fa-cog"></i></button>
          <button onclick="logout()" title="Logout"><i class="fas fa-sign-out-alt"></i></button>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Channel/DM Header -->
      <div class="content-header" id="content-header">
        <div class="header-info">
          <i class="fas fa-hashtag" id="header-icon"></i>
          <h2 id="header-title">Welcome</h2>
        </div>
        <div class="header-actions">
          <button class="header-btn" id="voice-join-btn" onclick="toggleVoiceChannel()" style="display: none;">
            <i class="fas fa-phone"></i> Join Voice
          </button>
          <button class="header-btn" onclick="showServerMembers()">
            <i class="fas fa-users"></i> Members
          </button>
        </div>
      </div>

      <!-- Messages Area -->
      <div class="messages-container" id="messages-container">
        <div class="welcome-screen" id="welcome-screen">
          <i class="fas fa-comments"></i>
          <h2>Welcome to OwnDc</h2>
          <p>Select a channel to start chatting or join a voice channel to talk with friends.</p>
        </div>
        <div class="messages-list" id="messages-list"></div>
      </div>

      <!-- Message Input -->
      <div class="message-input-container" id="message-input-container" style="display: none;">
        <div class="typing-indicator" id="typing-indicator"></div>
        <div class="message-input-wrapper">
          <button class="input-btn" title="Add attachment"><i class="fas fa-plus-circle"></i></button>
          <input type="text" id="message-input" placeholder="Message #general" onkeydown="if(event.key==='Enter'){sendMessage();}" oninput="handleTyping()">
          <button class="input-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
        </div>
      </div>
    </div>
  </div>

  <!-- Voice Call Overlay -->
  <div id="voice-overlay" class="voice-overlay hidden">
    <div class="voice-container">
      <div class="voice-header">
        <h3><i class="fas fa-phone-alt"></i> Voice Channel</h3>
        <button class="voice-close" onclick="leaveVoiceChannel()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="voice-participants" id="voice-participants"></div>
      <div class="voice-controls">
        <button class="voice-btn" id="mute-btn" onclick="toggleMute()">
          <i class="fas fa-microphone"></i>
          <span>Mute</span>
        </button>
        <button class="voice-btn" id="deafen-btn" onclick="toggleDeafen()">
          <i class="fas fa-headphones"></i>
          <span>Deafen</span>
        </button>
        <button class="voice-btn disconnect" onclick="leaveVoiceChannel()">
          <i class="fas fa-phone-slash"></i>
          <span>Disconnect</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Add Friend Modal -->
  <div id="add-friend-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ADD FRIEND</h3>
        <button class="modal-close" onclick="closeModal('add-friend-modal')"><i class="fas fa-times"></i></button>
      </div>
      <p class="modal-desc">You can add friends with their username.</p>
      <div class="modal-input-group">
        <input type="text" id="friend-username" placeholder="Enter a username" onkeypress="handleEnterKey(event, 'addFriend')">
        <button onclick="sendFriendRequest()">Send Friend Request</button>
      </div>
      <div id="friend-requests-list" class="friend-requests-list"></div>
    </div>
  </div>

  <!-- Create Channel Modal -->
  <div id="create-channel-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>CREATE CHANNEL</h3>
        <button class="modal-close" onclick="closeModal('create-channel-modal')"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-form">
        <div class="form-group">
          <label>CHANNEL TYPE</label>
          <div class="channel-type-selector">
            <button class="type-btn active" data-type="text" onclick="selectChannelType('text')">
              <i class="fas fa-hashtag"></i>
              <span>Text Channel</span>
            </button>
            <button class="type-btn" data-type="voice" onclick="selectChannelType('voice')">
              <i class="fas fa-volume-up"></i>
              <span>Voice Channel</span>
            </button>
          </div>
        </div>
        <div class="form-group">
          <label>CHANNEL NAME</label>
          <input type="text" id="channel-name" placeholder="new-channel" onkeypress="handleEnterKey(event, 'createChannel')">
        </div>
        <button class="modal-btn" onclick="createChannel()">Create Channel</button>
      </div>
    </div>
  </div>

  <!-- Create Group Modal -->
  <div id="create-group-modal" class="modal hidden">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3>CREATE GROUP DM</h3>
        <button class="modal-close" onclick="closeModal('create-group-modal')"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-form">
        <div class="form-group">
          <label>GROUP NAME</label>
          <input type="text" id="group-name" placeholder="My Group" onkeypress="handleEnterKey(event, 'createGroup')">
        </div>
        <div class="form-group">
          <label>SELECT FRIENDS</label>
          <div id="friend-selector-list" class="friend-selector-list">
            <!-- Friends will be loaded here -->
          </div>
        </div>
        <button class="modal-btn" onclick="createGroup()">Create Group</button>
      </div>
    </div>
  </div>

  <!-- Create Server Modal -->
  <div id="create-server-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>CREATE YOUR SERVER</h3>
        <button class="modal-close" onclick="closeModal('create-server-modal')"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-form">
        <p class="modal-desc">Give your new server a personality with a name. You can always change it later.</p>
        <div class="form-group">
          <label>SERVER NAME</label>
          <input type="text" id="server-name" placeholder="My Awesome Server" onkeypress="handleEnterKey(event, 'createServer')">
        </div>
        <button class="modal-btn" onclick="createServer()">Create Server</button>
      </div>
    </div>
  </div>

  <!-- Join Server Modal -->
  <div id="join-server-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>JOIN A SERVER</h3>
        <button class="modal-close" onclick="closeModal('join-server-modal')"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-form">
        <p class="modal-desc">Enter an invite link or code below to join an existing server.</p>
        <div class="form-group">
          <label>INVITE CODE</label>
          <input type="text" id="invite-code" placeholder="ABC123" onkeypress="handleEnterKey(event, 'joinServer')">
        </div>
        <button class="modal-btn" onclick="joinServer()">Join Server</button>
      </div>
    </div>
  </div>

  <!-- Video Call Overlay -->
  <div id="video-overlay" class="video-overlay hidden">
    <div class="video-container">
      <div class="video-header">
        <h3><i class="fas fa-video"></i> Video Call</h3>
        <button class="video-close" onclick="leaveVideoCall()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="video-grid" id="video-grid">
        <div class="video-item local-video">
          <video id="local-video" autoplay muted playsinline></video>
          <span class="video-label">You</span>
        </div>
      </div>
      <div class="video-controls">
        <button class="video-btn" id="video-mute-btn" onclick="toggleMute()">
          <i class="fas fa-microphone"></i>
          <span>Mute</span>
        </button>
        <button class="video-btn" id="video-camera-btn" onclick="toggleVideo()">
          <i class="fas fa-video"></i>
          <span>Video</span>
        </button>
        <button class="video-btn" id="screen-share-btn" onclick="toggleScreenShare()">
          <i class="fas fa-desktop"></i>
          <span>Screen</span>
        </button>
        <button class="video-btn disconnect" onclick="leaveVideoCall()">
          <i class="fas fa-phone-slash"></i>
          <span>End</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Server Members Modal -->
  <div id="server-members-modal" class="modal hidden">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3>SERVER MEMBERS</h3>
        <button class="modal-close" onclick="closeModal('server-members-modal')"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-form">
        <button class="modal-btn" onclick="showAddServerMembers()" style="margin-bottom: 16px; background-color: var(--success);">Invite Friends</button>
        <div id="server-members-list" class="server-members-list">
          <!-- Members will be loaded here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Add Server Members Modal -->
  <div id="add-server-members-modal" class="modal hidden">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3>INVITE FRIENDS TO SERVER</h3>
        <button class="modal-close" onclick="closeModal('add-server-members-modal')"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-form">
        <div class="form-group">
          <label>SELECT FRIENDS</label>
          <div id="server-friend-selector-list" class="friend-selector-list">
            <!-- Friends list with checkboxes -->
          </div>
        </div>
        <button class="modal-btn" onclick="addMembersToServer()">Add Selected Friends</button>
      </div>
    </div>
  </div>

  <!-- Direct Call Interface -->
  <div id="call-interface" class="call-interface hidden">
    <div class="call-header">
      <div class="call-info">
        <div class="call-avatar" id="call-avatar">?</div>
        <div class="call-details">
          <h3 id="call-name">Loading...</h3>
          <p id="call-duration">00:00</p>
        </div>
      </div>
      <button class="call-close" onclick="endDirectCall()"><i class="fas fa-times"></i></button>
    </div>
    <div class="call-video-container">
      <div class="video-grid" id="video-grid">
        <div class="local-video-wrapper">
          <video id="local-video-direct" autoplay muted playsinline style="width: 100%; height: 100%; border-radius: 8px; background: black;"></video>
          <div class="video-label">You</div>
        </div>
        <div class="remote-video-wrapper" id="remote-video-wrapper">
          <video id="remote-video-direct" autoplay playsinline style="width: 100%; height: 100%; border-radius: 8px; background: black;"></video>
          <div class="video-label" id="remote-video-label">Call in progress...</div>
        </div>
      </div>
    </div>
    <div class="call-controls">
      <button class="call-btn" id="direct-mute-btn" onclick="toggleDirectCallMute()" title="Mute">
        <i class="fas fa-microphone"></i>
      </button>
      <button class="call-btn" id="direct-video-btn" onclick="toggleDirectCallVideo()" title="Camera">
        <i class="fas fa-video"></i>
      </button>
      <button class="call-btn end" onclick="endDirectCall()" title="End Call">
        <i class="fas fa-phone-slash"></i>
      </button>
    </div>
  </div>

  <!-- Incoming Call Modal -->
  <div id="incoming-call-modal" class="modal hidden">
    <div class="modal-content" style="max-width: 350px; text-align: center; padding: 24px;">
      <div class="incoming-call-avatar" id="incoming-call-avatar" style="width: 80px; height: 80px; border-radius: 50%; background: var(--primary); margin: 0 auto 16px; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: bold; color: white;">?</div>
      <h3 id="incoming-call-name" style="margin-bottom: 8px;">Incoming Call...</h3>
      <p id="incoming-call-type" style="color: var(--text-secondary); margin-bottom: 24px;">Voice Call</p>
      <div style="display: flex; gap: 16px; justify-content: center;">
        <button onclick="acceptIncomingCall()" style="width: 60px; height: 60px; border-radius: 50%; background: var(--success); color: white; border: none; cursor: pointer; font-size: 24px;"><i class="fas fa-phone"></i></button>
        <button onclick="rejectIncomingCall()" style="width: 60px; height: 60px; border-radius: 50%; background: var(--danger); color: white; border: none; cursor: pointer; font-size: 24px;"><i class="fas fa-phone-slash"></i></button>
      </div>
      <audio id="ringtone-audio" loop>
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-waiting-ring-tone-1354.mp3" type="audio/mpeg">
      </audio>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div id="edit-profile-modal" class="modal hidden">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3>EDIT PROFILE</h3>
        <button class="modal-close" onclick="closeModal('edit-profile-modal')"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-form">
        <div class="form-group">
          <label>USERNAME</label>
          <input type="text" id="profile-username" placeholder="Your username">
        </div>
        <div class="form-group">
          <label>EMAIL</label>
          <input type="email" id="profile-email" placeholder="Your email">
        </div>
        <div class="form-group">
          <label>BIO</label>
          <textarea id="profile-bio" rows="3" placeholder="Tell us about yourself..."></textarea>
        </div>
        <div class="form-group">
          <label>PROFILE PICTURE URL</label>
          <input type="text" id="profile-avatar" placeholder="https://example.com/avatar.png">
        </div>
        <div class="form-group">
          <label>BANNER URL</label>
          <input type="text" id="profile-banner" placeholder="https://example.com/banner.png">
        </div>
        <div class="form-group">
          <label>CUSTOM STATUS</label>
          <input type="text" id="profile-status" placeholder="What's on your mind?" maxlength="100">
        </div>
        <button class="modal-btn" onclick="saveProfile()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div id="change-password-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>CHANGE PASSWORD</h3>
        <button class="modal-close" onclick="closeModal('change-password-modal')"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-form">
        <div class="form-group">
          <label>CURRENT PASSWORD</label>
          <input type="password" id="current-password" placeholder="Enter current password">
        </div>
        <div class="form-group">
          <label>NEW PASSWORD</label>
          <input type="password" id="new-password" placeholder="Enter new password">
        </div>
        <div class="form-group">
          <label>CONFIRM NEW PASSWORD</label>
          <input type="password" id="confirm-password" placeholder="Confirm new password">
        </div>
        <button class="modal-btn" onclick="changePassword()">Change Password</button>
      </div>
    </div>
  </div>

  <!-- Notifications -->
  <div id="notifications" class="notifications"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/app.js"></script>
</body>
</html>
